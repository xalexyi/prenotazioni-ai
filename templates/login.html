<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login — Ristorante AI</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <!-- Header snello con toggle -->
  <header class="header">
    <div class="brand">
      <span class="dot"></span>
      <span>Ristorante AI</span>
      <span class="text-dim">Area riservata ristoranti</span>
    </div>

    <!-- toggle tema -->
    <button id="themeToggle" class="toggle" type="button" aria-label="Tema">
      <span class="knob"></span>
    </button>
  </header>

  <main class="container">
    <div class="login-grid">

      <!-- Box istruzioni -->
      <section class="login-card">
        <div class="card pad" style="background: radial-gradient(1200px 600px at -20% -40%, #16355d 0%, transparent 55%), linear-gradient(180deg, #0e1624 0%, #0c1422 80%);">
          <h2 class="title">Benvenuto/a <span aria-hidden="true">👋</span></h2>

          <div class="quick-box">
            <h4 class="text-dim" style="margin:0 0 .6rem 0">Istruzioni rapide</h4>
            <div class="form-row">
              <div class="w-100">
                <ul style="margin:.2rem 0 .8rem 1rem; padding:0; line-height:1.6;">
                  <li><strong>Inserisci username</strong> del ristorante</li>
                  <li>Digita la <strong>password</strong></li>
                  <li>Clicca <strong>“Log in”</strong></li>
                </ul>
              </div>
            </div>

            <div class="form-row">
              <div class="w-100">
                <h4 class="text-dim" style="margin:.6rem 0 .4rem 0">Dopo il login vedrai</h4>
                <ul style="margin:.2rem 0 0 1rem; padding:0; line-height:1.6;">
                  <li><span class="badge badge-success">●</span> <strong>Chiamate attive</strong> e stato linea</li>
                  <li><span class="badge badge-info">📅</span> <strong>Prenotazioni del giorno</strong></li>
                  <li>⚡ Azioni rapide: <strong>Conferma / Rifiuta / Elimina</strong></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Box form -->
      <section class="login-card">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="toast" id="flashToast">
              {% for category, message in messages %}
                {{ message }}
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <form action="{{ url_for('login_page') }}" method="post" class="card pad" autocomplete="on">
          <div class="form-row">
            <div>
              <label for="username">Username</label>
              <input class="input" id="username" name="username" value="{{ request.form.get('username','') }}" required>
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="password">Password</label>
              <input class="input" id="password" name="password" type="password" required>
            </div>
          </div>

          <div class="form-row" style="align-items:center; justify-content:space-between;">
            <label class="text-muted" style="display:flex; align-items:center; gap:.45rem;">
              <input type="checkbox" name="remember" {% if request.form.get('remember') == 'on' %}checked{% endif %}>
              Rimani connesso
            </label>

            <button class="btn btn-primary" type="submit">Log in</button>
          </div>

          <p class="demo-note">
            Demo: <strong>sushitokyo</strong> / <em>Password123!</em> — <strong>pizzerianapoli</strong> / <em>Password123!</em>
          </p>
        </form>
      </section>

    </div>
  </main>

  <!-- Nessuna modale pre-render sulla pagina login -->
  <script>
    // Tema persistente
    (function () {
      const key = "ui:theme";
      const btn = document.getElementById("themeToggle");
      function apply(theme){
        if (theme === "light") {
          document.documentElement.style.setProperty('--bg', '#f6f7fb');
          document.documentElement.style.setProperty('--text', '#0b1320');
          // (opzionale) adatta altri token per light
        } else {
          // reset “light” → i valori di default del CSS sono dark
          document.documentElement.removeAttribute('style');
        }
        btn?.setAttribute('data-state', theme === "light" ? "on" : "off");
      }
      const saved = localStorage.getItem(key) || "dark";
      apply(saved);
      btn?.addEventListener('click', () => {
        const now = btn.getAttribute('data-state') === 'on' ? 'dark' : 'light';
        localStorage.setItem(key, now);
        apply(now);
      });
    })();

    // Focus iniziale e auto-hide flash
    (function(){
      const u = document.getElementById('username');
      const p = document.getElementById('password');
      (u && !u.value ? u : p)?.focus();
      const t = document.getElementById('flashToast');
      if (t) setTimeout(()=> t.remove(), 2600);
    })();
  </script>
</body>
</html>
