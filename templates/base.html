<!doctype html>
<html lang="it" data-theme="{{ (request.cookies.get('theme') or 'light') }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Ristorante AI{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='img/logo_robot.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block head %}{% endblock %}
  </head>
  <body class="app-body {% if restaurant and restaurant.slug == 'pizzerianapoli' %}accent-pizza{% endif %}">
    <header class="app-header">
      <div class="header-left">
        {% block header_left %}
          {# Logo: se restaurant.logo √® valorizzato lo usiamo, altrimenti robot #}
          {% set _logo_file = 'img/logo_robot.svg' %}
          {% if restaurant and restaurant.logo %}
            {% set _logo_file = 'img/' + restaurant.logo %}
          {% endif %}
          <div class="brand-row">
            <img class="logo-robot restaurant-logo" src="{{ url_for('static', filename=_logo_file) }}" alt="logo">
            <div class="brand-title">
              <span class="brand-strong">{{ restaurant.name if restaurant else 'Ristorante AI' }}</span>
              <span class="brand-sub">‚Äî {% block brand_sub %}Dashboard ristorante{% endblock %}</span>
            </div>
          </div>
        {% endblock %}
      </div>

      <div class="header-right">
        {% block header_right %}
          <!-- Toggle Giorno/Notte -->
          <button id="themeToggle" class="toggle theme-toggle" aria-label="Tema Giorno/Notte" title="Giorno/Notte">
            <span class="toggle-icon sun">‚òÄÔ∏è</span>
            <span class="toggle-icon moon">üåô</span>
          </button>
          <!-- Logout -->
          <a href="{{ url_for('auth.logout') }}" class="btn btn-red logout-btn">Logout</a>
        {% endblock %}
      </div>
    </header>

    <main class="app-main">
      {% block content %}{% endblock %}
    </main>

    {% block scripts_head %}{% endblock %}
    <script>
      // Toggle Giorno/Notte con persistenza su localStorage
      (function(){
        const root = document.documentElement;
        const btn  = document.getElementById('themeToggle');
        function setTheme(t){
          root.setAttribute('data-theme', t);
          try { localStorage.setItem('theme', t); } catch(e){}
        }
        try {
          const saved = localStorage.getItem('theme');
          if (saved) root.setAttribute('data-theme', saved);
        } catch(e){}
        if (btn){
          btn.addEventListener('click', () => {
            const cur = root.getAttribute('data-theme') || 'light';
            setTheme(cur === 'dark' ? 'light' : 'dark');
          });
        }
      })();
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
