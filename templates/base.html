<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Ristorante AI{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='img/logo_robot.svg') }}">

    <!-- Imposta il tema prima di caricare il CSS per evitare FOUC -->
    <script>
      (function(){
        try {
          var saved = localStorage.getItem('theme');
          if (!saved) {
            saved = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          }
          document.documentElement.setAttribute('data-theme', saved || 'light');
        } catch(e) {
          document.documentElement.setAttribute('data-theme', 'light');
        }
      })();
    </script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block head %}{% endblock %}
  </head>
  <body class="app-body {% if restaurant and restaurant.slug == 'pizzerianapoli' %}accent-pizza{% endif %}">
    <header class="app-header">
      <div class="header-left">
        {% block header_left %}
          {# Logo: se restaurant.logo √® valorizzato lo usiamo, altrimenti robot #}
          {% set _logo_file = 'img/logo_robot.svg' %}
          {% if restaurant and restaurant.logo %}
            {% set _logo_file = 'img/' + restaurant.logo %}
          {% endif %}
          <div class="brand-row">
            <img class="logo-robot restaurant-logo" src="{{ url_for('static', filename=_logo_file) }}" alt="logo">
            <div class="brand-title">
              <span class="brand-strong">{{ restaurant.name if restaurant else 'Ristorante AI' }}</span>
              <span class="brand-sub">‚Äî {% block brand_sub %}Dashboard ristorante{% endblock %}</span>
            </div>
          </div>
        {% endblock %}
      </div>

      <div class="header-right">
        {% block header_right %}
          <!-- Toggle Giorno/Notte -->
          <button id="themeToggle" class="toggle theme-toggle" aria-label="Tema Giorno/Notte" title="Giorno/Notte">
            <span class="toggle-icon sun">‚òÄÔ∏è</span>
            <span class="toggle-icon moon">üåô</span>
          </button>
          <!-- Logout (se utente loggato) -->
          <a href="{{ url_for('auth.logout') }}" class="btn btn-red logout-btn">Logout</a>
        {% endblock %}
      </div>
    </header>

    <main class="app-main">
      {% block content %}{% endblock %}
    </main>

    {% block scripts_head %}{% endblock %}
    <!-- JS comuni -->
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}" defer></script>
    {% block scripts %}{% endblock %}
  </body>
</html>
