<!doctype html>
<html lang="it" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Ristorante AI{% endblock %}</title>

  <link rel="icon" href="{{ url_for('static', filename='img/logo_robot.svg') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=5">

  {% block head %}{% endblock %}
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img class="brand__logo" src="{{ url_for('static', filename='img/logo_robot.svg') }}" alt="logo">
      <div class="brand__text">
        <div class="brand__title">
          {{ g.restaurant.name if g.get('restaurant') else 'Haru Asian Fusion Restaurant' }}
        </div>
        <div class="brand__subtitle">â€” Dashboard ristorante</div>
      </div>
    </div>

    <div class="header-actions">
      <button id="themeToggle" class="btn btn-icon" aria-label="Tema">
        <span class="icon-moon"></span>
      </button>

      <form id="logoutForm" method="post" action="{{ url_for('auth.logout') }}">
        <button id="logoutBtn" class="btn btn-danger">Logout</button>
      </form>
    </div>
  </header>

  <main class="app-main">
    {% block content %}{% endblock %}
  </main>

  <script>
    // Tema persistente
    (() => {
      const root = document.documentElement;
      const saved = localStorage.getItem('theme') || 'dark';
      root.setAttribute('data-theme', saved);
      document.getElementById('themeToggle')?.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        root.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      });

      // Logout: POST con fallback a GET, poi redirect a /login
      const logoutForm = document.getElementById('logoutForm');
      const logoutBtn  = document.getElementById('logoutBtn');
      logoutBtn?.addEventListener('click', async (e) => {
        e.preventDefault();
        try {
          const r = await fetch(logoutForm.action, { method: 'POST' });
          if (!r.ok) throw new Error();
        } catch {
          await fetch(logoutForm.action, { method: 'GET' }).catch(()=>{});
        } finally {
          window.location.href = '/login';
        }
      });
    })();
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
