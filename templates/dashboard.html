{% extends "base.html" %}
{% block title %}Dashboard â€” Ristorante AI{% endblock %}
{% block brand %}{{ current_user.restaurant.name }}{% endblock %}
{% block brand_sub %}<span class="brand-sub">â€” Dashboard ristorante</span>{% endblock %}

{% block body %}
<div class="container">
  <div class="grid kpis">
    <div class="card kpi-bar">
      <div class="kpi-title">Chiamate attive: <strong id="kpiActiveCalls">0/3</strong></div>
      <div class="status">
        <span class="led led-green"></span> Disponibile
      </div>
    </div>

    <div class="card kpi-small">
      <div class="kpi-sub">Prenotazioni oggi</div>
      <div class="kpi-value" id="kpiToday">0</div>
    </div>

    <div class="card kpi-small">
      <div class="kpi-sub">Incasso stimato</div>
      <div class="kpi-value" id="kpiRevenue">0 â‚¬</div>
    </div>
  </div>

  <div class="card filters">
    <div class="filter-row">
      <div class="date-input">
        <input id="flt-date" class="input" type="date" aria-label="Data">
        <span class="calendar-ico">ðŸ“…</span>
      </div>
      <input id="flt-q" class="input grow" type="text" placeholder="Cerca nome / telefono / orario">
      <div class="row-gap"></div>
      <button id="btn-filter" class="btn">Filtra</button>
      <button id="btn-clear" class="btn btn-ghost">Elimina filtri</button>
      <button id="btn-30d" class="btn btn-ghost">Storico 30gg</button>
      <button id="btn-today" class="btn btn-ghost">Oggi</button>
      <button id="btn-new" class="btn btn-primary right">+ Nuova prenotazione</button>
    </div>
  </div>

  <div id="list" class="grid"></div>

  <div id="list-empty" class="card empty" style="display:none">
    <div class="empty-title">Nessuna prenotazione trovata</div>
    <div class="muted">Prova a cambiare filtri o aggiungi una nuova prenotazione.</div>
    <button class="pill minus" aria-label="collapse">âˆ’</button>
  </div>
</div>

<!-- Modal Crea/Modifica prenotazione -->
<div class="modal" id="modal-reservation" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-head">
      <div class="modal-title" id="mr-title">Crea prenotazione</div>
      <button class="btn-icon" data-close="modal-reservation">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="grid-2">
        <label class="lbl">Data
          <input id="mr-date" class="input" type="date" required>
        </label>
        <label class="lbl">Ora
          <input id="mr-time" class="input" type="time" step="300" required>
        </label>
      </div>

      <label class="lbl">Nome
        <input id="mr-name" class="input" type="text" required>
      </label>

      <div class="grid-2">
        <label class="lbl">Telefono
          <input id="mr-phone" class="input" type="tel">
        </label>
        <label class="lbl">Persone
          <input id="mr-people" class="input" type="number" min="1" value="2" required>
        </label>
      </div>

      <label class="lbl">Stato
        <select id="mr-status" class="input">
          <option value="Confermata">Confermata</option>
          <option value="In attesa">In attesa</option>
          <option value="Annullata">Annullata</option>
        </select>
      </label>

      <label class="lbl">Note
        <input id="mr-note" class="input" type="text" placeholder="Allergie, tavolo, ecc.">
      </label>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modal-reservation">Chiudi</button>
      <button class="btn btn-primary" id="mr-save">Salva prenotazione</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Abilita pulsanti sidebar per aprire i modals giÃ  esistenti gestiti da main.js
  document.getElementById('openHours')?.addEventListener('click', () => window.ui?.openWeeklyHours?.());
  document.getElementById('openSpecial')?.addEventListener('click', () => window.ui?.openSpecialDays?.());
  document.getElementById('openPrices')?.addEventListener('click', () => window.ui?.openPrices?.());
  document.getElementById('openMenu')?.addEventListener('click', () => window.ui?.openDigitalMenu?.());
  document.getElementById('openStats')?.addEventListener('click', () => window.ui?.openStats?.());

  // Nuova prenotazione apre modal
  document.getElementById('btn-new')?.addEventListener('click', () => {
    window.ui?.openReservationModal?.();
  });
</script>
{% endblock %}
