{% extends "base.html" %}

{% block header_left %}
<div class="brand-row">
  <img class="logo-robot"
       src="{{ url_for('static', filename='img/' + (restaurant.logo or 'logo_robot.svg')) }}"
       alt="logo">
  <div class="brand-title">
    <span class="brand-strong">{{ restaurant.name or 'Ristorante' }}</span> ‚Äî
    <span class="brand-sub">Dashboard ristorante</span>
  </div>
</div>
{% endblock %}

{% block header_right %}
<button id="themeToggle" class="toggle theme-toggle" aria-label="Tema Giorno/Notte" title="Giorno/Notte">
  <span class="toggle-icon sun">‚òÄÔ∏è</span>
  <span class="toggle-icon moon">üåô</span>
</button>
<a class="btn btn-red logout-btn" href="{{ url_for('auth.logout') }}">Logout</a>
{% endblock %}

{% block content %}
<div class="dash-grid">
  <!-- Stato linea / Badge chiamate attive -->
  <section class="card soft-card" id="voice-badge" data-rid="{{ restaurant.id }}">
    <div class="soft-title">
      Chiamate attive:
      <span class="strong"><span id="vb-active">0</span>/<span id="vb-max">3</span></span>
    </div>
    <div class="soft-right">
      <span class="dot" id="vb-dot"></span>
      <span class="soft-label" id="vb-label">Disponibile</span>
    </div>
  </section>

  <!-- KPI -->
  <section class="kpi-grid {% if is_pizzeria %}kpi-3{% else %}kpi-2{% endif %}">
    <div class="card kpi-card">
      <div class="kpi-title">Prenotazioni oggi</div>
      <div class="kpi-value" id="kpi-today">0</div>
    </div>

    {% if is_pizzeria %}
    <div class="card kpi-card">
      <div class="kpi-title">Pizze ordinate</div>
      <div class="kpi-value" id="kpi-pizzas">0</div>
    </div>
    {% endif %}

    <div class="card kpi-card">
      <div class="kpi-title">Incasso stimato</div>
      <div class="kpi-value" id="kpi-revenue">‚Ç¨ 0</div>
    </div>
  </section>

  <!-- Filtri -->
  <section class="card filters">
    <input id="f-date" class="input" type="date" value="{{ today or '' }}">
    <input id="f-text" class="input" type="text" placeholder="Cerca nome / telefono / orario">
    <button id="btn-filter" class="btn btn-gray" aria-label="Applica filtri">Filtra</button>
    <button id="btn-clear" class="btn btn-outline" aria-label="Elimina filtri">Elimina filtri</button>
    <button id="btn-30" class="btn btn-outline">Storico 30gg</button>
    <button id="btn-today" class="btn btn-outline">Oggi</button>

    <button id="btn-new" class="btn btn-primary push-right">+ Nuova prenotazione</button>
  </section>

  <!-- Lista -->
  <section class="card">
    <div id="list" class="list"></div>
  </section>
</div>

<!-- Modale -->
<div id="modal" class="modal-backdrop" aria-hidden="true">
  <div class="modal card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-head">
      <h3 id="modalTitle" class="card-title">Nuova prenotazione</h3>
      <button id="modalClose" class="btn btn-icon" aria-label="Chiudi">‚úñ</button>
    </div>

    <div class="modal-body">
      <label class="form-label" for="m-name">Nome cliente</label>
      <input id="m-name" class="input" type="text" placeholder="Nome">

      <label class="form-label" for="m-phone">Telefono</label>
      <input id="m-phone" class="input" type="tel" placeholder="Telefono">

      <label class="form-label" for="m-date">Data</label>
      <input id="m-date" class="input" type="date" value="{{ today or '' }}">

      <label class="form-label" for="m-time">Ora</label>
      <input id="m-time" class="input" type="time" value="20:00">

      <label class="form-label" for="m-people">Persone</label>
      <input id="m-people" class="input" type="number" value="2" min="1">

      {% if is_pizzeria %}
      <!-- SOLO PIZZERIA: area pizze -->
      <div class="pizza-box">
        <div class="pizza-head">
          <span class="card-title" style="margin:0;">üçï Pizze</span>
          <button id="pizzaAdd" type="button" class="btn btn-outline">+ Aggiungi pizza</button>
        </div>
        <div id="pizzaRows" class="pizza-rows"></div>
      </div>
      {% endif %}
    </div>

    <div class="modal-foot">
      <button id="modalSave" class="btn btn-primary">Salva</button>
    </div>
  </div>
</div>

<!-- Flag JS e accent pizzeria -->
<script>
  window.IS_PIZZERIA = {{ 1 if is_pizzeria else 0 }} === 1;
  (function(){
    var slug = "{{ restaurant.slug or '' }}";
    if (slug === "pizzerianapoli") {
      document.body.classList.add("accent-pizza");
    } else {
      document.body.classList.remove("accent-pizza");
    }
  })();
</script>
{% endblock %}

{% block scripts %}
<!-- JS esistente della pagina prenotazioni -->
<script defer src="{{ url_for('static', filename='js/reservations.js') }}"></script>
<!-- NOVIT√Ä: JS che aggiorna il badge delle chiamate -->
<script defer src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
