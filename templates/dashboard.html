{% extends "base.html" %}
{% block title %}Dashboard — Ristorante{% endblock %}

{% block content %}
<div class="topbar">
  <div class="kpi kpi--status">
    <div class="kpi__pill kpi__pill--ok">
      <span class="dot dot--green"></span> Disponibile
    </div>
    <div class="kpi__meta">Chiamate attive: <b id="callsActive">0/3</b></div>
  </div>

  <div class="kpi kpi--bookings">
    <div class="kpi__title">Prenotazioni oggi</div>
    <div class="kpi__value" id="bookingsToday">0</div>
    <div class="kpi__meta">Incasso stimato: <b id="revenueToday">€ 0</b></div>
  </div>

  <div class="actions dropdown" id="actions">
    <button id="actionsBtn" class="btn btn-icon" aria-haspopup="menu" aria-expanded="false">
      <span class="icon-dots"></span>
    </button>
    <div class="dropdown-menu" role="menu" id="actionsMenu">
      <button class="dropdown-item" data-open="#modalHours">Orari settimanali…</button>
      <button class="dropdown-item" data-open="#modalSpecial">Giorni speciali…</button>
      <button class="dropdown-item" data-open="#modalSettings">Impostazioni…</button>
      <button class="dropdown-item" data-open="#modalSummary">Stato & riepilogo…</button>
      <button class="dropdown-item" data-open="#modalToken">Imposta token…</button>
    </div>
  </div>
</div>

<section class="card bookings-card">
  <div class="row row--wrap gap-8 align-center">
    <div class="input input--with-icon">
      <input id="dateFilter" type="text" placeholder="gg/mm/aaaa" />
      <span class="icon-calendar"></span>
    </div>
    <div class="input grow">
      <input id="search" type="text" placeholder="Cerca nome / telefono / orario" />
    </div>
    <div class="btn-group">
      <button id="btnFilter"   class="btn">Filtra</button>
      <button id="btnClear"    class="btn">Elimina filtri</button>
      <button id="btn30"       class="btn">Storico 30gg</button>
      <button id="btnToday"    class="btn btn-primary">Oggi</button>
      <button id="btnRefresh"  class="btn">Aggiorna</button>
      <button id="btnCreate"   class="btn btn-primary" data-open="#modalCreate">Crea prenotazione</button>
    </div>
  </div>
</section>

<!-- MODALE: ORARI SETTIMANALI -->
<div class="modal" id="modalHours" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-head">
      <h3>Orari settimanali</h3>
      <button class="btn btn-icon modal-close" data-close><span class="icon-x"></span></button>
    </div>
    <div class="modal-body">
      <p class="muted">Formato: <b>HH:MM-HH:MM</b> (es. <code>12:00-15:00</code>, <code>19:00-23:30</code>). Giorno vuoto = <b>CHIUSO</b>.</p>
      <div id="hoursForm" class="hours-grid">
        <!-- 7 righe generate da JS -->
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn" data-close>Chiudi</button>
      <button class="btn btn-primary" id="saveHoursBtn">Salva</button>
    </div>
  </div>
</div>

<!-- MODALE: GIORNI SPECIALI -->
<div class="modal" id="modalSpecial" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-head">
      <h3>Giorni speciali</h3>
      <button class="btn btn-icon modal-close" data-close><span class="icon-x"></span></button>
    </div>
    <div class="modal-body">
      <div class="row gap-8">
        <div class="input input--with-icon">
          <input id="specialDate" type="text" placeholder="gg/mm/aaaa" />
          <span class="icon-calendar"></span>
        </div>
        <label class="chk">
          <input id="specialClosed" type="checkbox"> Chiudi tutto il giorno
        </label>
      </div>
      <div class="input">
        <input id="specialWindows" type="text" placeholder="Finestre (se aperto) es. 12:00-15:00, 19:00-23:30" />
      </div>

      <div id="specialList" class="special-list"></div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-danger" id="deleteSpecialBtn">Elimina</button>
      <button class="btn btn-primary" id="saveSpecialBtn">Aggiungi / Aggiorna</button>
    </div>
  </div>
</div>

<!-- MODALE: IMPOSTAZIONI -->
<div class="modal" id="modalSettings" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-head">
      <h3>Impostazioni</h3>
      <button class="btn btn-icon modal-close" data-close><span class="icon-x"></span></button>
    </div>
    <div class="modal-body settings-grid" id="settingsForm">
      <!-- campi creati da JS -->
    </div>
    <div class="modal-foot">
      <button class="btn" data-close>Chiudi</button>
      <button class="btn btn-primary" id="saveSettingsBtn">Salva impostazioni</button>
    </div>
  </div>
</div>

<!-- MODALE: RIEPILOGO -->
<div class="modal" id="modalSummary" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-head">
      <h3>Stato & riepilogo</h3>
      <button class="btn btn-icon modal-close" data-close><span class="icon-x"></span></button>
    </div>
    <div class="modal-body" id="summaryBody">
      <!-- riempito da JS -->
    </div>
    <div class="modal-foot">
      <button class="btn" data-close>Chiudi</button>
    </div>
  </div>
</div>

<!-- MODALE: TOKEN -->
<div class="modal" id="modalToken" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-head">
      <h3>Imposta token</h3>
      <button class="btn btn-icon modal-close" data-close><span class="icon-x"></span></button>
    </div>
    <div class="modal-body">
      <div class="input">
        <input id="tokenInput" type="text" placeholder="Incolla qui il token">
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn" data-close>Chiudi</button>
      <button class="btn btn-primary" id="saveTokenBtn">Salva</button>
    </div>
  </div>
</div>

<!-- MODALE: CREA PRENOTAZIONE -->
<div class="modal" id="modalCreate" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-head">
      <h3>Crea prenotazione</h3>
      <button class="btn btn-icon modal-close" data-close><span class="icon-x"></span></button>
    </div>
    <div class="modal-body create-grid" id="createForm">
      <!-- campi creati da JS -->
    </div>
    <div class="modal-foot">
      <button class="btn" data-close>Chiudi</button>
      <button class="btn btn-primary" id="saveBookingBtn">Salva prenotazione</button>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}?v=9"></script>
{% endblock %}
