{% extends "base.html" %}
{% block title %}Dashboard â€” Ristorante AI{% endblock %}
{% block brand %}{{ current_user.restaurant.name }}{% endblock %}
{% block brand_sub %}<span class="brand-sub">â€” Dashboard ristorante</span>{% endblock %}

{% block body %}
<div class="container">
  <div class="grid kpis">
    <div class="card kpi-bar">
      <div class="kpi-title">Chiamate attive: <strong id="kpiActiveCalls">0/3</strong></div>
      <div class="status"><span class="led led-green"></span> Disponibile</div>
    </div>

    <div class="card kpi-small">
      <div class="kpi-sub">Prenotazioni oggi</div>
      <div class="kpi-value" id="kpiToday">0</div>
    </div>

    <div class="card kpi-small">
      <div class="kpi-sub">Incasso stimato</div>
      <div class="kpi-value" id="kpiRevenue">0 â‚¬</div>
    </div>
  </div>

  <div class="card filters">
    <div class="filter-row">
      <div class="date-input">
        <input id="flt-date" class="input" type="date" aria-label="Data">
        <span class="calendar-ico">ðŸ“…</span>
      </div>
      <input id="flt-q" class="input grow" type="text" placeholder="Cerca nome / telefono / orario">
      <div class="row-gap"></div>
      <button id="btn-filter" class="btn">Filtra</button>
      <button id="btn-clear" class="btn btn-ghost">Elimina filtri</button>
      <button id="btn-30d" class="btn btn-ghost">Storico 30gg</button>
      <button id="btn-today" class="btn btn-ghost">Oggi</button>
      <button id="btn-new" class="btn btn-primary right">+ Nuova prenotazione</button>
    </div>
  </div>

  <div id="list-empty" class="card empty">
    <div class="empty-title">Nessuna prenotazione trovata</div>
    <div class="muted">Prova a cambiare filtri o aggiungi una nuova prenotazione.</div>
    <button class="pill minus" aria-label="collapse">âˆ’</button>
  </div>

  <div id="list" class="grid"></div>
</div>

<!-- Modale Orari settimanali -->
<div id="dlgHours" class="modal">
  <div class="modal-card">
    <div class="modal-head">
      <h3>Orari settimanali</h3>
      <button class="btn-x" data-close="dlgHours">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="muted">Formato: <b>HH:MM-HH:MM</b> (es. 12:00-15:00, 19:00-22:30). Giorno vuoto = <b>CHIUSO</b>.</div>
      <div class="hours-grid">
        {% for i, d in [(0,'LunedÃ¬'),(1,'MartedÃ¬'),(2,'MercoledÃ¬'),(3,'GiovedÃ¬'),(4,'VenerdÃ¬'),(5,'Sabato'),(6,'Domenica')] %}
        <label class="lbl">
          {{ d }}
          <input class="input hours" data-day="{{ i }}" placeholder="12:00-15:00, 19:00-22:30">
        </label>
        {% endfor %}
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn" data-close="dlgHours">Chiudi</button>
      <button id="btn-save-hours" class="btn btn-primary">Salva</button>
    </div>
  </div>
</div>

<!-- Modale Giorni speciali -->
<div id="dlgSpecial" class="modal">
  <div class="modal-card">
    <div class="modal-head">
      <h3>Giorni speciali</h3>
      <button class="btn-x" data-close="dlgSpecial">Ã—</button>
    </div>
    <div class="modal-body">
      <label class="lbl">Data
        <input id="sp-date" type="date" class="input">
      </label>
      <label class="check">
        <input id="sp-closed" type="checkbox">
        <span>Chiudi tutto il giorno</span>
      </label>
      <label class="lbl">Finestre (se aperto)
        <input id="sp-windows" type="text" class="input" placeholder="18:00-23:00, 12:00-15:00">
      </label>
      <div class="muted" style="margin-top:8px">Esempio: 18:00-23:00, 12:00-15:00</div>
    </div>
    <div class="modal-foot">
      <button class="btn" data-close="dlgSpecial">Chiudi</button>
      <button id="btn-del-special" class="btn">Elimina</button>
      <button id="btn-save-special" class="btn btn-primary">Aggiungi / Aggiorna</button>
    </div>
  </div>
</div>

<!-- Modale Nuova prenotazione -->
<div id="dlgNew" class="modal">
  <div class="modal-card">
    <div class="modal-head">
      <h3>Nuova prenotazione</h3>
      <button class="btn-x" data-close="dlgNew">Ã—</button>
    </div>
    <form id="newResForm">
      <div class="modal-body">
        <div class="grid-2" style="gap:12px">
          <label class="lbl">Data
            <input id="nr-date" type="date" class="input" required>
          </label>
          <label class="lbl">Ora
            <input id="nr-time" type="time" class="input" required>
          </label>
          <label class="lbl">Nome
            <input id="nr-name" type="text" class="input" placeholder="Mario Rossi" required>
          </label>
          <label class="lbl">Telefono
            <input id="nr-phone" type="tel" class="input" placeholder="+39 333 1234567">
          </label>
          <label class="lbl">Persone
            <select id="nr-people" class="input" required>
              <option value="1">1</option><option value="2" selected>2</option>
              <option value="3">3</option><option value="4">4</option>
              <option value="5">5</option><option value="6">6</option>
              <option value="7">7</option><option value="8">8</option>
            </select>
          </label>
          <label class="lbl">Stato
            <select id="nr-status" class="input">
              <option value="Confermata" selected>Confermata</option>
              <option value="In attesa">In attesa</option>
              <option value="Annullata">Annullata</option>
            </select>
          </label>
          <label class="lbl" style="grid-column:1/-1">Note
            <input id="nr-note" type="text" class="input" placeholder="Allergie, richieste, ecc.">
          </label>
        </div>
      </div>
      <div class="modal-foot">
        <button type="button" class="btn" data-close="dlgNew">Chiudi</button>
        <button type="submit" class="btn btn-primary">Salva</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
