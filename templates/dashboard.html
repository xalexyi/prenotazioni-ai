{% extends "base.html" %}
{% block title %}Dashboard — Ristorante{% endblock %}

{% block content %}
<main class="container">

  <!-- Menu a 3 puntini -->
  <div class="menu-wrap" style="margin-bottom:12px">
    <button class="menu-dots" data-menu-toggle="#admin-menu">⋮</button>
    <div id="admin-menu" class="menu hidden">
      <button onclick="openModal('modal-orari')">Orari settimanali…</button>
      <button onclick="openModal('modal-giorni')">Giorni speciali…</button>
      <button onclick="openModal('modal-imp')">Impostazioni…</button>
      <button onclick="openModal('modal-stato')">Stato & riepilogo…</button>
      <button onclick="openModal('modal-token')">Imposta token…</button>
    </div>
  </div>

  <!-- Card stato e KPI -->
  <section class="grid-stats">
    <div class="stat bot-status">
      <div class="badge-green">
        <span class="badge-dot"></span> Disponibile
      </div>
      <div>Chiamate attive: 0/3</div>
    </div>
    <div class="stat">
      <div class="muted">Prenotazioni oggi</div>
      <h2 style="margin:6px 0 2px">0</h2>
      <div class="muted">Incasso stimato: <b>€ 0</b></div>
    </div>
  </section>

  <!-- Box Prenotazioni -->
  <section class="card box-reservations mt-16">
    <h3 class="section-title">Prenotazioni</h3>
    <div class="row filters">
      <input id="flt-date" type="date" class="input" />
      <div class="row" style="flex:1; min-width:280px">
        <input id="flt-text" class="input" placeholder="Cerca nome / telefono / orario" />
      </div>
      <button class="btn" id="btnFilter">Filtra</button>
      <button class="btn-outline" id="btnClear">Elimina filtri</button>
      <button class="btn" id="btnLast30">Storico 30gg</button>
      <button class="btn-blue" id="btnToday">Oggi</button>
      <button class="btn" id="btnRefresh">Aggiorna</button>
      <button class="btn-blue" onclick="openModal('modal-prenotazione')">Crea prenotazione</button>
    </div>
    <!-- Qui potresti avere tabella prenotazioni -->
  </section>
</main>

<!-- ====== MODALI ====== -->

<!-- Orari settimanali -->
<div id="modal-orari">
  <div class="modal-header">
    <div class="modal-title">Orari settimanali</div>
    <button class="modal-close" onclick="closeModal('modal-orari')">✕</button>
  </div>
  <div class="modal-body">
    <p class="tip">Formato: <span class="kbd">HH:MM-HH:MM</span> (es. <span class="kbd">12:00-15:00</span>, <span class="kbd">19:00-23:30</span>). Giorno vuoto = <b>CHIUSO</b>.</p>
    <div class="hours-list">
      {% for day in ["Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato","Domenica"] %}
      <div class="row">
        <label style="width:120px">{{ day }}</label>
        <input type="text" class="input" placeholder="12:00-15:00, 19:00-23:30" />
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn" onclick="closeModal('modal-orari')">Chiudi</button>
    <button class="btn-blue">Salva</button>
  </div>
</div>

<!-- Giorni speciali -->
<div id="modal-giorni">
  <div class="modal-header">
    <div class="modal-title">Giorni speciali</div>
    <button class="modal-close" onclick="closeModal('modal-giorni')">✕</button>
  </div>
  <div class="modal-body">
    <div class="row">
      <input type="date" class="input" />
      <label class="row"><input type="checkbox" /> Chiudi tutto il giorno</label>
    </div>
    <input type="text" class="input mt-8" placeholder="Finestre (se aperto)" />
  </div>
  <div class="modal-footer">
    <button class="btn-danger">Elimina</button>
    <button class="btn-blue">Aggiungi / Aggiorna</button>
  </div>
</div>

<!-- Impostazioni -->
<div id="modal-imp">
  <div class="modal-header">
    <div class="modal-title">Impostazioni</div>
    <button class="modal-close" onclick="closeModal('modal-imp')">✕</button>
  </div>
  <div class="modal-body">
    <div class="row"><label style="width:160px">Timezone</label><input class="input" value="Europe/Rome" /></div>
    <div class="row"><label style="width:160px">Step (min)</label><input class="input" type="number" value="15" /></div>
    <div class="row"><label style="width:160px">Ultimo ordine (min)</label><input class="input" type="number" value="15" /></div>
    <div class="row"><label style="width:160px">Min persone</label><input class="input" type="number" value="1" /></div>
    <div class="row"><label style="width:160px">Max persone</label><input class="input" type="number" value="12" /></div>
    <div class="row"><label style="width:160px">Capacità/slot</label><input class="input" type="number" value="6" /></div>
  </div>
  <div class="modal-footer">
    <button class="btn" onclick="closeModal('modal-imp')">Chiudi</button>
    <button class="btn-blue">Salva impostazioni</button>
  </div>
</div>

<!-- Stato & riepilogo -->
<div id="modal-stato">
  <div class="modal-header">
    <div class="modal-title">Stato & riepilogo</div>
    <button class="modal-close" onclick="closeModal('modal-stato')">✕</button>
  </div>
  <div class="modal-body">
    <div class="section-title">Orari settimanali</div>
    <ul style="margin:0;padding-left:18px">
      <li>Lunedì: CHIUSO</li><li>Martedì: CHIUSO</li><li>Mercoledì: CHIUSO</li>
      <li>Giovedì: CHIUSO</li><li>Venerdì: CHIUSO</li><li>Sabato: CHIUSO</li><li>Domenica: CHIUSO</li>
    </ul>
    <div class="section-title mt-16">Giorni speciali</div>
    <ul style="margin:0;padding-left:18px"><li>2025-12-25: CHIUSO</li></ul>
  </div>
  <div class="modal-footer">
    <button class="btn" onclick="closeModal('modal-stato')">Chiudi</button>
  </div>
</div>

<!-- Imposta token -->
<div id="modal-token">
  <div class="modal-header">
    <div class="modal-title">Imposta token</div>
    <button class="modal-close" onclick="closeModal('modal-token')">✕</button>
  </div>
  <div class="modal-body">
    <input class="input" placeholder="Incolla qui il token" />
  </div>
  <div class="modal-footer">
    <button class="btn-blue" onclick="showToast('Token salvato ✅','success');closeModal('modal-token')">Salva</button>
  </div>
</div>

<!-- Crea prenotazione -->
<div id="modal-prenotazione">
  <div class="modal-header">
    <div class="modal-title">Crea prenotazione</div>
    <button class="modal-close" onclick="closeModal('modal-prenotazione')">✕</button>
  </div>
  <div class="modal-body">
    <div class="row">
      <input type="date" class="input" />
      <input type="time" class="input" value="20:00" />
    </div>
    <div class="row">
      <input class="input" placeholder="Nome e cognome" />
      <input class="input" placeholder="Telefono" />
    </div>
    <div class="row">
      <input class="input" type="number" value="2" />
      <select class="input"><option>Confermata</option><option>In attesa</option></select>
    </div>
    <textarea class="input" placeholder="Allergie, tavolo, ecc."></textarea>
  </div>
  <div class="modal-footer">
    <button class="btn" onclick="closeModal('modal-prenotazione')">Chiudi</button>
    <button class="btn-blue">Salva prenotazione</button>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
